# 打卡统计 (996)

## 问题背景

芃芃在霓虹国愉快地玩了好几天，还给女朋友精心准备了礼物。回国以后，他发现自己俨然已经身无长物，于是只能靠到公司 996 来养活自己。这家公司记录了每个人的门禁刷卡信息，每个月都要进行一次统计。又到了月底，这次芃芃接到了任务……

## 问题描述

本次作业中，你需要实现以下内容：

1. 一个 Python 程序 `statistics.py`，接受四个参数（分别为员工信息文件名、打卡信息文件名和按个人、按部门的输出统计文件名），按照下面的要求对打卡信息进行统计。
2. 一个 `Makefile`，它能够自动对 `data` 目录下所有形如 `*.people.csv` 和 `*.record.csv` 的文件运行上面的程序，输出路径为同一目录下的 `*.stats_people.csv` 和 `*.stats_dep.csv`，并且具有一个 `clean` 目标，删除所有输出文件。

在完成任务时，你需要使用 `pandas` 的 `merge`, `group_by` 或者其他库（如 SQLite）与其等价的关系代数操作，而不应该直接使用 Python 操作数据。

### 输入格式

输入文件共有两个，均使用 UTF-8 编码。员工信息 `*.people.csv` 格式如下：

```text
id,name,title,department
1,本达,董事长,董事会
2,杰哥,总经理,管理部
...
114514,芃芃,全栈程序员,开发部
```

除了第一行外，每一行共有四个字段，分别为员工的 ID （一个整数）、姓名、职务和部门（后三者均为字符串）。

打卡记录 `*.record.csv` 格式如下：

```text
id,time
114514,2019-07-10T02:45:48
114514,2019-07-11T03:23:33
2,2019-07-11T09:32:32
...
1,2019-07-23T12:20:16
```

除了第一行外，每一行第一个字段为员工 ID，第二个字段为打卡时间。保证相同 ID 的打卡时间不重复。

### 输出格式

要求统计每人、每部门的打卡信息，输出到两个文件中，均使用 UTF-8 编码。个人统计 `*.stats_people.csv` 格式如下：

```text
id,name,title,department,count,latest,earliest
1,本达,董事长,董事会,194,2019-07-23T12:20:16,2018-09-05T09:10:05
...
114514,芃芃,全栈程序员,开发部,666,2019-07-23T04:14:02,2019-07-10T02:45:48
```

其中前四个字段与员工信息中相同，`count` 为该员工总打卡计数，`latest` 和 `earliest` 分别是该员工最后一次和第一次打卡时间（注意格式需要与输入的相同）。记录需要**按照总打卡次数降序排列**，如果相同，则再**按照 ID 升序排列**。

部门统计 `*.stats_department.csv` 格式如下：

```text
department,count,latest,earliest
董事会,194,2019-07-23T12:20:16,2018-09-05T09:10:05
...
开发部,23333,2019-07-23T04:14:02,2016-08-16T08:06:34
```

其中各个字段的含义不再解释，只是聚合对象从员工更换为部门。

## 数据与评分

本次评分的数据全部下发，位于 `data` 目录下，共 10 组。最终分数构成如下：

1. 正确性测试 80 分：每组数据 8 分，只当你的输出与答案中的数据**完全一致**时才得分
2. `Makefile` 10 分：正确书写通用规则，能够不重复、不遗漏地调用脚本执行任务，并能够使用 `clean` 删除输出文件
3. 白盒 10 分：代码风格 5 分、Git 使用 5 分

你可以调用 `grade.py` 来获取你的本地评分。

## 提示

本次作业看似简单，但有很多需要注意的细节，属于比较综合的题目。

1. 读取与写入 `csv` 文件时需要注意文件的编码（特别是 Windows 上）
2. 可以借助 `datetime` 库来对时间进行解析和格式化输出，**不可直接作为字符串排序**
3. 每次执行程序会产生多个输出文件，因此需要对 `Makefile` 进行恰当的修改（提供了一个简单的范例）

最后，恭喜你已经完成了本课程所有的小作业。希望你在这短短四周的时间内有自己的收获，初探数据处理的奥秘，学有所成。

最后的最后，芃芃那么 rich，怎么可能去打工呢？他当然是过上了幸福的生活啦！
